define(["jquery"],function(a){a.fn.calendar=function(t){var e=a.extend({},a.fn.calendar.defaults,t);return this.each(function(){function t(a,t){f.empty(),r(),n(a,t),p(a,t),e.changeDateEvent()}function r(){if(0!=y){var t=a('<tr class="week_days" >'),e="";a(v).each(function(a,t){e+="<td",0==a&&(e+=' class="first"'),6==a&&(e+=' class="last"'),e+=">"+t+"</td>"}),e+="</tr>",t.append(e),f.append(t)}}function n(a,t){u.text(h[a]+" "+t);for(var e=1,r=s(1,a,t),n=i(a,t),o=a+1,l="",p=0;p<7;p++){if(p<r){var c="";0==p&&(c+="<tr>"),c+='<td class="invalid',0==p&&(c+=" first"),c+='"></td>'}else{var c="";0==p&&(c+="<tr>"),c+='<td id="'+_+"_"+e+"_"+o+"_"+t+'" ',0==p&&(c+=' class="first"'),6==p&&(c+=' class="last"'),c+="><a>"+e+"</a></span>",6==p&&(c+="</tr>"),e++}l+=c}for(var d=1;e<=n;){var c="";d%7==1&&(c+="<tr>"),c+='<td id="'+_+"_"+e+"_"+o+"_"+t+'" ',d%7==1&&(c+=' class="first"'),d%7==0&&(c+=' class="last"'),c+="><a>"+e+"</a></td>",d%7==0&&(c+="</tr>"),e++,d++,l+=c}if(--d%7!=0){c="";for(var p=d%7+1;p<=7;p++){var c="";c+='<td class="invalid',7==p&&(c+=" last"),c+='"></td>',7==p&&(c+="</tr>"),l+=c}}f.append(l)}function s(a,t,e){return new Date(e,t,a).getDay()}function o(a,t,e){return a>0&&a<13&&e>0&&e<32768&&t>0&&t<=new Date(e,a,0).getDate()}function i(a,t){for(var e=28;o(a+1,e+1,t);)e++;return e}function l(a){var t=a.split("/");return 3==t.length&&o(t[1],t[0],t[2])}function p(t,e){0!=b?a.ajax({type:b.type,url:b.url,data:{month:t+1,year:e},dataType:"json"}).done(function(r){g=[],a.each(r,function(a,t){g.push(r[a])}),c(t,e)}):c(t,e)}function c(t,e){for(var r=t+1,n=0;n<g.length;n++)if(g[n][0].split("/")[1]==r&&g[n][0].split("/")[2]==e){if(a("#"+_+"_"+g[n][0].replace(/\//g,"_")).addClass("event"),a("#"+_+"_"+g[n][0].replace(/\//g,"_")+" a").attr("data-original-title",g[n][1]),g[n][3]){var s=a("#"+_+"_"+g[n][0].replace(/\//g,"_"));s.append("<span></span>").find("span").css("background",g[n][3])}""==g[n][2]||"#"==g[n][2]?""!=g[n][4]?(a("#"+_+"_"+g[n][0].replace(/\//g,"_")+" a").attr("data-trigger","manual"),a("#"+_+"_"+g[n][0].replace(/\//g,"_")+" a").addClass("manual_popover")):a("#"+_+"_"+g[n][0].replace(/\//g,"_")+" a").attr("href","javascript:false;"):a("#"+_+"_"+g[n][0].replace(/\//g,"_")+" a").attr("href",g[n][2]),g[n][4]?(a("#"+_+"_"+g[n][0].replace(/\//g,"_")).addClass("event_popover"),a("#"+_+"_"+g[n][0].replace(/\//g,"_")+" a").attr("rel","popover"),a("#"+_+"_"+g[n][0].replace(/\//g,"_")+" a").attr("data-content",g[n][4])):(a("#"+_+"_"+g[n][0].replace(/\//g,"_")).addClass("event_tooltip"),a("#"+_+"_"+g[n][0].replace(/\//g,"_")+" a").attr("rel","tooltip"))}}var d,f,v,u=a('<div class="visualmonthyear"></div>'),_="cal_"+Math.floor(99999*Math.random()).toString(36),g=e.events;v=void 0!==e.days?e.days:["S","M","T","W","T","F","S"];var h;h=void 0!==e.months?e.months:["January","February","March","April","May","June","July","August","September","October","November","December"];var y;y=void 0===e.show_days||e.show_days;"undefined"!=e.popover_options&&e.popover_options;void 0!==e.tooltip_options&&e.tooltip_options;var b;b=void 0!==e.req_ajax&&e.req_ajax;var m=a(this);!function(){f=a('<table class="daysmonth table table">'),r();var e=new Date,s=m.val();if(""!=s&&l(s)){var o=s.split("/");2==o[2].length&&("0"==o[2].charAt(0)&&(o[2]=o[2].substring(1)),o[2]=parseInt(o[2]),o[2]<50&&(o[2]+=2e3)),e=new Date(o[2],o[1]-1,o[0])}var i=e.getMonth(),c=e.getFullYear();n(i,c);var v=a('<td><i class="fa fa-arrow-right"></i></td>');v.click(function(a){a.stopPropagation(),a.preventDefault(),i=(i+1)%12,0==i&&c++,t(i,c)});var g=a('<td><i class="fa fa-arrow-left"></i></td>');g.click(function(a){a.stopPropagation(),a.preventDefault(),i-=1,-1==i&&(c--,i=11),t(i,c)}),a(".icon-arrow-left").css("cursor","pointer"),a(".icon-arrow-right").css("cursor","pointer");var h=a('<table class="table header"><tr></tr></table>'),y=a('<td colspan=5 class="year span6"></td>');h.append(g),h.append(y),h.append(v),y.append(u),d=a('<div class="calendar" id="'+_+'" ></div>'),d.prepend(h),d.append(f),m.append(d),p(i,c)}()}),this}});